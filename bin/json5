#!/usr/bin/env node

var fs = require('fs'),
    JSON5 = require('../json5'),
    opt = require('opt');


opt.setup(
    'USAGE: ' + process.argv[0] + ' [file]',
    'SYNOPSIS: Converts JSON5 to JSON.  Reads from stdin by default.',
    'OPTIONS');
opt.set(['-h','--help'], opt.usage, "This help document.");

// Parse the command line options
if (process.argv.length > 1) {
    console.error(opt.usage());
    process.exit(1);
} else {
    opt.parse(process.argv);
}

argv._.length === 0 ? (inputStream = process.stdin).resume() : inputStream = fs.createReadStream(argv._[0]);

// TODO: Is always using UTF8 for input/output desirable?
inputStream.on('data', function (data) {
    json5Input += data;
});
inputStream.on('end', function () {
    process.stdout.write(JSON.stringify(JSON5.parse(json5Input)));
});
